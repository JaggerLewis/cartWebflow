const baseurl="https://app-api.mypet.fit",REDIRECT={login:"login",dashboard:"profil-chien",home:"home",abo:"upgrade",stop:"confirmation-de-resiliation",active:"step1",active_2:"step2",active_3:"step3",formula_life:"lifetimeformula",email:"emailsent"},ACTIVITY_PICT={footing:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac295bff47ea0f59445_Group%20196451acti.png",crossfit:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac2470b045e31f85937_6acti.png",bike:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac215d605db1af32818_Group%20196442acti.png",promenade:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/6613c05e432b743847c086b6_baladeitem.png",cani_rando:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac25eb3f6af15fc8579_acti6.png",rescue:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/654b6a20bf057d68593d620a_logo.png",away:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac2f93ad3ea98b44562_acti5.png",city_dogsitting:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c8ac2470b045e31f8584a_Group%20196424acti.png"};let loaderContainer,user,dog,session,display,option,token,map,circle,path,header={"Content-Type":"application/json"};const findAbonnementSolo=e=>abonnement.find(e=>"formula_unique"==e.metadata.pId).prices.find(t=>t.metadata.pricing==e),findNewAbonnementSolo=e=>abonnement.filter(e=>e.metadata.pId.includes("formula_unique_")).find(t=>t.metadata.pricing==e),converTimestamp=e=>{var t=Math.floor;let a=t(e/86400),n=t(e%86400/3600),i=t(e%3600/60),l="";return 0<a&&(l+=a+" jour"+(1<a?"s":"")+" "),0<n&&(l+=n+" heure"+(1<n?"s":"")+" "),0<i&&(l+=i+" minute"+(1<i?"s":"")),l},initClient={"jl-profil-user-name":e=>e.innerHTML=session?.order?.customer?.name??"","jl-nav-dog-name":e=>e.innerHTML=dog?.name??"","jl-nav-dog-pict":e=>{dog?e.src="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid:null,dog?e.srcset="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid:null},"jl-profil-dog-picture":e=>{e.src="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid,e.srcset="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid},"jl-profil-dog-name":e=>e.innerHTML=dog.name,"jl-profil-dog-id":e=>e.innerHTML="@"==dog.publicId[0]?dog.publicId:`@${dog.publicId}`,"jl-logout":e=>e.addEventListener("click",()=>logout()),"jl-collar-battery":e=>e.innerHTML=(dog.battery.soc??"0")+"%","jl-collar-serial":e=>e.innerHTML=dog.collar.serialNumber,"jl-collar-id":e=>e.innerHTML=dog.collar.name,"jl-collar-activation":e=>e.innerHTML=getDate(dog.collar.activationDate),"jl-collar-version":e=>e.innerHTML=dog.collar.firmwareVersion,"jl-collar-autonomy":e=>e.innerHTML=-1==dog.battery.estimated?"":getTrad("Il reste environ "+converTimestamp(dog.battery.estimated)+" d'autonomie","There's about "+converTimestamp(dog.battery.estimated)+" of autonomy left"),"jl-collar-synchro-date":e=>e.innerHTML=dog.geolocation?.LastConnect?getTrad("Derni\xE8re mise \xE0 jour: ","Last update: ")+getDate(parseInt(Math.round(dog.geolocation.LastConnect)+"000")):"",jl_Activation_serialNumber:e=>e.value=new URLSearchParams(window.location.search).get("sn"),jl_Activation_phoneNumber:()=>checkActivationToken(),"jl-map":e=>initMap(e),"jl-geofencing-label":e=>initGeoFencingLabel(e),"jl-geofencing-switch":e=>initGeoFencingSwitch(e),"jl-smartdock-card":e=>initSmartDock(e),"jl-is-moment":()=>initActivity("moment"),"jl-activity-activity":e=>e.addEventListener("click",()=>initActivity("activity")),"jl-activity-rescue":e=>e.addEventListener("click",()=>initActivity("rescue")),"jl-is-activity":()=>initActivity("activity"),jl_Activation_Action:e=>e.addEventListener("click",()=>checkActivation()),jl_Abonnement_starter_action:e=>e.addEventListener("click",()=>aboAction("monthly")),jl_Abonnement_family_action:e=>e.addEventListener("click",()=>aboAction("yearly")),"jl-galerie-link":e=>e.innerHTML=e.innerHTML.replace("{{nameDog}}",dog.name),jl_Abonnement_Premium_action:e=>e.addEventListener("click",()=>aboAction("life")),"jl-formula-action":e=>e.addEventListener("click",()=>formulaPageSwitch("abo")),"jl-option-action":e=>e.addEventListener("click",()=>formulaPageSwitch("option")),"jl-insurance-action":e=>e.addEventListener("click",()=>formulaPageSwitch("insurance")),jl_Btn_phoneToken:e=>e.addEventListener("click",()=>validateAction()),"jl-connect-action":e=>e.addEventListener("click",()=>loginEmail()),"jl-connect-action-bis":e=>e.addEventListener("click",()=>loginCode()),"jl-profil-dog-list":e=>initDashboard(e),"jl-order-container":()=>initOrder(),"jl-order-order":e=>e.addEventListener("click",()=>switchInfo("order")),"jl-order-info":e=>e.addEventListener("click",()=>switchInfo("info")),"jl-delete-email":e=>e.addEventListener("click",()=>deleteAccountEmail()),"jl-delete-sms-action":e=>initDelete(e),"jl-formula-close-action":e=>e.addEventListener("click",()=>cancelSubScriptionEmail()),"jl-formula-good-action":e=>e.addEventListener("click",()=>redirectAbo()),jl_switch_month:e=>e.addEventListener("click",()=>changeSubscription("monthly")),jl_switch_year:e=>e.addEventListener("click",()=>changeSubscription("yearly")),jl_switch_life:e=>e.addEventListener("click",()=>changeSubscription("life")),"jl-activation-resend-code":e=>e.addEventListener("click",()=>resendActivationCode()),"jl-resend-code":e=>e.addEventListener("click",()=>resendCode()),"jl-collar-synchro-state":e=>e.innerHTML=dog.geolocation.endpointStatus?getTrad("Le bo\xEEtier est connect\xE9","Your collar is connected"):getTrad("Le bo\xEEtier est en veille","Your collar is on StandBy"),"jl-collar-synchro-last-date":e=>e.innerHTML=dog.flash.tmsLastInfo?getDate(dog.flash.tmsLastInfo):getTrad("Pas encore synchronis\xE9","Not yet synchronized"),"jl-galery-list-0":()=>intiPict(),"jl-rescue-action":()=>loadRescue(),"jl-change-formula-action":()=>getDog(dog._id),"jl-collar-activate":e=>setActivateBtn(e),"jl-mail-confirm-desc":async e=>setEmail(e),"jl-life-formula":()=>setLifeFormula(),"jl-abo-historic":e=>e.addEventListener("click",()=>showAboHistoric()),"jl-popup-close":e=>e.addEventListener("click",()=>document.getElementById("jag-historic-popup").style.display="none"),"jl-active-action-close":e=>e.addEventListener("click",()=>document.getElementById("jl-active-action-popup").style.display="none"),"jl-active-action-ok":e=>e.addEventListener("click",()=>restartAbo())},setChecked=(e,t)=>{switch(t){case"yes":e.src="https://daks2k3a4ib2z.cloudfront.net/6549f4ba8294cf140608d893/661639b3c90093bedf11e0bc_okok-p-130x130q80.png";break;case"no":e.src="https://daks2k3a4ib2z.cloudfront.net/6549f4ba8294cf140608d893/664c61cb6fa65cf70148611b_croix-p-130x130q80.png";break;case"warn":e.src="https://daks2k3a4ib2z.cloudfront.net/6549f4ba8294cf140608d893/6644c9d79a46a0d3ef658985_i.png";break;default:}},loadAbonnement=async()=>{let e=Date.now(),t=await fetch(`${interfaceUrl}/stripe/products/category/subscription`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(async e=>e.json());localStorage.setItem("ts-abonnement",e),localStorage.setItem("abonnement",JSON.stringify(t))},showAboHistoric=async()=>{document.getElementById("jag-historic-popup").style.display="flex";let e=document.getElementById("jag-abo-historic-card"),t=await fetch("https://app-api.mypet.fit/user/order",{headers:header}).then(async e=>await e.json()).then(e=>e.orders);t.filter(e=>"product"!=e.type).reverse().forEach(t=>{let a=e.cloneNode(!0);changeChildsId(a,"-"+t._id,"jag-"),e.parentElement.appendChild(a);let n=new Date(t.createdAt);document.getElementById("jag-abo-historic-date-"+t._id).innerHTML=n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),document.getElementById("jag-abo-historic-type-"+t._id).innerHTML=(t.total.total??100)/100+"\u20AC",document.getElementById("jag-abo-historic-check-"+t._id).style.backgroundColor="#5363ff",document.getElementById("jag-abo-historic-pdf-"+t._id).addEventListener("click",async()=>{loaderContainer.style.display="flex",fetch("https://app-api.mypet.fit/order/"+t._id+"/pdf",{method:"GET",headers:header}).then(e=>e.blob()).then(e=>{const n=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.href=n,i.download="jl-facture-"+t._id+".pdf",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n)}),loaderContainer.style.display="none"})}),e.style.display="none"},setLifeFormula=async()=>{abonnement=await loadAbonnement();let e=abonnement.filter(e=>e.metadata.pId.includes("formula_unique_")),t=(e.find(e=>"life"==e.metadata.pricing).prices[0].price/36).toFixed(2)+"\u20AC";document.getElementById("jl-abo-life-price").innerHTML=e.find(e=>"life"==e.metadata.pricing).prices[0].price.toFixed(2)+"\u20AC",document.getElementById("jl-abo-life-price-info").innerHTML=getTrad("Soit "+t+"/mois sur 3 ans","Or "+t+"/month over 3 years")},setEmail=async e=>{await getUser(),e.innerHTML=e.innerHTML.replace("{{email}}",user.email)},setActivateBtn=async e=>{await getDog(),dog.collar.settings?.isVirtual||dog.collar.settings?.isDumped||JSON.parse(dog.collar.settings?.simActivated??"{}").isActivated?e.style.display="none":(e.style.display="flex",e.addEventListener("click",()=>window.open(REDIRECT.active+`?sn=${dog.collar.serialNumber}&HeyJag=${token}`,"_self")))},loadRescue=()=>{let e=document.createElement("script");e.type="text/javascript",e.src="https://webcart.jagger-lewis.com/jlrescue.min.js",document.getElementsByTagName("head")[0].appendChild(e)},logout=()=>{window.localStorage.clear(),window.open(REDIRECT.login,"_self")};let intiPict=()=>{let e=document.getElementById("jag-pict-container"),t=[];user.galery.forEach(a=>{let n="https://app-api.mypet.fit/img/"+a.image.type+"/"+a.image.uuid,i=e.cloneNode(!0);i.src=n,i.srcset=n,i.style.display="flex";let l=document.getElementById("jl-galery-list-"+new Date(a.timestamp).getMonth());l.appendChild(i),t.includes(new Date(a.timestamp).getMonth())||(t.push(new Date(a.timestamp).getMonth()),l.parentElement.parentElement.childNodes[0].click())})};const initSmartDock=e=>{let t=dog.dock?.result?.assigned;if(null==t)return void(e.style.display="none");if(document.getElementById("jl-smartdock-title").innerHTML=t?getTrad("Smartdock appair\xE9","Smartdock paired"):getTrad("Smartdock non-appair\xE9","Smartdock not paired"),!t)document.getElementById("jl-smartdock-desc").innerHTML=getTrad("Configurez-le sur l'application","Configure it on the application");else{let e=dog.dock?.data?.dock_status?.isConnected??!1;document.getElementById("jl-smartdock-desc").innerHTML=e?getTrad("Connect\xE9","Connected"):getTrad("Non-Connect\xE9","Not connected"),e||(document.getElementById("jl-smartdock-pic-activate").parentElement.style.display="none",document.getElementById("jl-smartdock-pic-desactivate").parentElement.style.display="flex")}},initGeoFencingLabel=e=>{if(!dog.collar.settings.geofencing)return void(e.innerHTML="Non configur\xE9e");let t=JSON.parse(dog.collar.settings.geofencing);""==t.label&&(document.getElementById("jag-geofencing-card").style.display="none"),e.innerHTML=`${t.active?getTrad("Activ\xE9e","Activated"):getTrad("D\xE9sactiv\xE9e","Unactivated")} ${getTrad(`dans un rayon de ${t.radius}m autour de ${t.label.name}`,`within a radius of ${t.radius}m around ${t.label.name}`)}`},initGeoFencingSwitch=e=>{if(!dog.collar.settings.geofencing)return;let t=JSON.parse(dog.collar.settings.geofencing);e.innerHTML=`<label class="switch"><input type="checkbox" id="jag-geofencing-slider" ><span class="slider round" ></span></label>`;let a=document.getElementById("jag-geofencing-slider");a.checked=t.active,a.addEventListener("click",async()=>{t.active=a.checked;let e=await fetch(baseurl+`/collar/${dog.collar.simcardID}/settings`,{headers:header,method:"POST",body:JSON.stringify({field:["geofencing"],value:[JSON.stringify({active:a.checked})]})}).then(async e=>e.json());"001"==e.code&&(document.getElementById("jl-geofencing-label").innerHTML=`${t.active?"Active":"D\xE9sacti\xE9"} dans un rayon de ${t.radius}m autour de ${t.label.name}`)})},deleteAccountEmail=async()=>{let e=await fetch("https://app-api.mypet.fit/user/delete/email",{method:"POST",headers:header});200==e.status?window.open(REDIRECT.email,"_self"):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},redirectAbo=async()=>{localStorage.removeItem("user"),getDog(dog._id),window.open(REDIRECT.home,"_self"),checkAuth()},initDelete=async e=>{let t=new URL(window.location.href).searchParams.get("type");return"subscription_cancel"==t?(await getDog(),document.getElementById("jag-delete-text-stop").style.display="flex",document.getElementById("jag-delete-text-delete").style.display="none",document.getElementById("jag-delete-text-stop").innerHTML=document.getElementById("jag-delete-text-stop").innerHTML.replace("{{date}}",getDate(dog.collar.formula_subscription.timeout)),void e.addEventListener("click",()=>cancelSubScription())):void(document.getElementById("jag-delete-text-stop").style.display="none",document.getElementById("jag-delete-text-delete").style.display="flex",e.addEventListener("click",()=>deleteAccountSms()))},deleteAccountSms=async()=>{let e=document.getElementById("jag-delete-sms-input");if(!e)return void showAddCart("Oups, une erreur est survenue, rechargez la page",!0);let t=e.value;if(7!=t.length)return void showAddCart(getTrad("Code incorrect","Incorrect code"),!1);let a=await fetch("https://app-api.mypet.fit/user/delete",{method:"DELETE",headers:header,body:JSON.stringify({phoneToken:t})});200==a.status?(window.location.replace("/seconnecter"),localStorage.removeItem("token"),checkAuth()):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},clearFamily=()=>{let e=document.getElementById("jl-family-container").childNodes;for(let t=e.length-1;0<=t;t--)e[t].id.includes("jag-family-card-")?e[t].remove():null};let initGalery=()=>{let e=document.getElementById("jag-profil-identity-gallery-container"),t=document.getElementById("jag-profil-identity-gallery-pict");for(let a=0;3>a;a++){if(!user.galery[a])return;if(document.getElementById("jag-profil-identity-gallery-pict-"+user.galery[a].image._id))return;let n=t.cloneNode(!0),i=user.galery[a];if(!i)return;n.style.display="flex",changeChildsId(n,"-"+i.image._id,"jag-"),e.insertBefore(n,e.firstChild),document.getElementById("jag-profil-identity-gallery-pict-"+i.image._id).src="https://app-api.mypet.fit/img/"+i.image.type+"/"+i.image.uuid,document.getElementById("jag-profil-identity-gallery-pict-"+i.image._id).srcset="https://app-api.mypet.fit/img/"+i.image.type+"/"+i.image.uuid}};const initFamily=()=>{clearFamily();let e=document.getElementById("jl-family-container"),t=document.getElementById("jag-family-card"),a=t.cloneNode(!0);a.style.display="flex",changeChildsId(a,"-"+user._id,"jag-"),e.appendChild(a),document.getElementById("jag-family-pict-"+user._id).src="https://app-api.mypet.fit/img/"+user.image.type+"/"+user.image.uuid,document.getElementById("jag-family-pict-"+user._id).srcset="https://app-api.mypet.fit/img/"+user.image.type+"/"+user.image.uuid,document.getElementById("jag-family-name-"+user._id).innerHTML=user.name,document.getElementById("jag-family-type-"+user._id).innerHTML=getTrad("Propri\xE9taire","Owner");dog.family&&dog.family.forEach(a=>{let n=t.cloneNode(!0);n.style.display="flex",changeChildsId(n,"-"+a._id,"jag-"),e.appendChild(n),document.getElementById("jag-family-pict-"+a._id).src="https://app-api.mypet.fit/img/"+a.image.type+"/"+a.image.uuid,document.getElementById("jag-family-pict-"+a._id).srcset="https://app-api.mypet.fit/img/"+a.image.type+"/"+a.image.uuid,document.getElementById("jag-family-name-"+a._id).innerHTML=a.name,document.getElementById("jag-family-type-"+a._id).innerHTML=getTrad("Ma Famille","My Family")})},switchInfo=e=>{let t=["var(--main)","var(--gristypofaible)"];"info"==e&&(t=t.reverse()),document.getElementById("jl-order-order").style.color=t[0],document.getElementById("jl-order-order").style.borderColor=t[0],document.getElementById("jl-order-info").style.color=t[1],document.getElementById("jl-order-info").style.borderColor=t[1],document.getElementById("jag-order-list").style.display="info"==e?"none":"flex",document.getElementById("jag-info-container").style.display="info"==e?"flex":"none"},initOrder=async()=>{const e=e=>"new"===e?getTrad("En cours de traitement","Currently being processed"):`(${e})`;loaderContainer.style.display="flex";let t=["var(--main)","var(--gristypofaible)"];document.getElementById("jl-order-order").style.color=t[0],document.getElementById("jl-order-order").style.borderColor=t[0],document.getElementById("jl-order-info").style.color=t[1],document.getElementById("jl-order-info").style.borderColor=t[1];let a=await fetch("https://app-api.mypet.fit/user/order",{headers:header}).then(async e=>await e.json()).then(e=>e.orders),n=document.getElementById("jl-order-container"),i=document.getElementById("jag-order-list");a.filter(e=>"product"==e.type).forEach(t=>{newCard=n.cloneNode(!0),newCard.style.display="flex",changeChildsId(newCard,"-"+t._id,"jag-"),i.appendChild(newCard),document.getElementById("jag-order-ref-"+t._id).innerHTML=t?.orderNumber,document.getElementById("jag-order-date-"+t._id).innerHTML=getDate(t.createdAt),document.getElementById("jag-order-price-"+t._id).innerHTML=(t?.total?.total??100)/100+"\u20AC",document.getElementById("jag-order-status-"+t._id).innerHTML=e(t.status),document.getElementById("jag-order-action-"+t._id).addEventListener("click",async()=>{loaderContainer.style.display="flex",fetch("https://app-api.mypet.fit/order/"+t._id+"/pdf",{method:"GET",headers:header}).then(e=>e.blob()).then(e=>{const n=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.href=n,i.download=`jl-${getTrad("facture","invoice")}-${t._id}.pdf`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n)}),loaderContainer.style.display="none"}),document.getElementById("jag-order-list").style.display="flex",n.style.display="none",initInfos()})},initInfos=async()=>{document.getElementById("jag-info-container").style.display="none";let e,t=await fetch("https://app-api.mypet.fit/user/customer",{headers:header});404==t.status?(showAddCart(getTrad("Utilisateur introuvable...","User not found...")),setTimeout(()=>{history.back()},"1000")):e=await t.json(),e?(document.getElementById("jag-info-name").innerHTML=e.result.customer.name,document.getElementById("jag-info-firstname").innerHTML=e.result.customer.name,document.getElementById("jag-info-email").innerHTML=e.result.customer.email,document.getElementById("jag-info-livraison").innerHTML=e.result.customer?.address?e.result.customer?.address.line1+","+e.result.customer?.address?.city:getTrad("Inconnue","Unknown"),document.getElementById("jag-info-phone").innerHTML=e.result.customer.phone.replace("0033","0"),document.getElementById("jag-info-facture").innerHTML=e.result.customer?.address?e.result.customer?.address.line1+","+e.result.customer?.address?.city:getTrad("Inconnue","Unknown"),loaderContainer.style.display="none"):(showAddCart(getTrad("Utilisateur introuvable...","User not found...")),setTimeout(()=>{history.back()},"1000"))},loginEmail=async()=>{let e=document.getElementById("jag-email").value;if(e.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)){let t=await fetch("https://app-api.mypet.fit/login",{method:"POST",headers:header,body:JSON.stringify({email:e})}).then(async e=>await e.json());"004"==t.code?document.getElementById("jag-code-popup").style.display="flex":showAddCart(getTrad("Email inconnu","Email unknown"))}else showAddCart(getTrad("Format email incorrect","Incorrect email format"))},loginCode=async()=>{let e=document.getElementById("Jag_PhoneToken").value,t=document.getElementById("jag-email").value;if(7==e.length){let a=await fetch("https://app-api.mypet.fit/login",{method:"POST",headers:header,body:JSON.stringify({email:t,phoneToken:e})}).then(async e=>await e.json());if(a.token){window.localStorage.setItem("token",a.token);let e=new URLSearchParams(window.location.search);if(e.has("redirect")){let t=e.get("redirect");t=REDIRECT[t]??REDIRECT.home,window.location.replace(t)}else window.open(REDIRECT.home,"_self")}else showAddCart(getTrad("Code incorrect","Incorrect code"))}else showAddCart(getTrad("Le code doit \xEAtre au format 1234567","The code must be in the format 123457"))},formulaPageSwitch=e=>{ids=["abo","option","insurance"],display=e,ids.forEach(e=>{let t=document.getElementById("jag-"+e+"-container");return t?void(t.style.display=e==display?"block":"none"):void console.log("no found :",display)})},cancelSubScription=async()=>{let e=document.getElementById("jag-delete-sms-input"),t=dog.collar.formula_subscription._id;if(e&&7==e.value.length){let a=await fetch(baseurl+`/formula_subscription/${t}/cancel`,{method:"POST",headers:header,body:JSON.stringify({phoneToken:e.value})});200==a.status?(window.open(REDIRECT.stop,"_self"),checkAuth()):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)}else showAddCart(getTrad("Code incorrect","Incorrect code"))},cancelSubScriptionEmail=async()=>{let e=dog.collar.formula_subscription._id,t=await fetch(baseurl+`/formula_subscription/${e}/cancel/email`,{method:"POST",headers:header,body:JSON.stringify({subscription:e,collarId:dog.collar._id})}).then(async e=>await e.json());t.success?window.open(REDIRECT.email,"_self"):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},changeSubscription=async e=>{await loadAbonnement(),abonnement=JSON.parse(localStorage.getItem("abonnement"));let t=findNewAbonnementSolo(e).prices[0].id,a=await fetch("https://app-api.mypet.fit/stripe/checkout_session/subscription/update",{method:"POST",headers:header,body:JSON.stringify({subscription:t,collarId:dog.collar._id})}).then(async e=>await e.json());a.url?window.open(a.url):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},restartAbo=async()=>{loaderContainer.style.display="flex",await fetch(baseurl+`/formula_subscription/${dog.collar.formula_subscription._id}/uncancel`,{method:"POST",headers:header}),await getDog(dog._id),loaderContainer.style.display="none",document.getElementById("jl-active-action-popup").style.display="none",getAll()},initOption=async()=>{["abo"].forEach(e=>{let t,a=document.getElementById("jag-"+e+"-card"),n=findNewAbonnementSolo(dog.collar.formula_subscription.type??"life");switch(document.getElementById("jag-abo-container").style.display="block",dog.collar.formula_subscription.status){case"resilied":document.getElementById("jag-abo-stoped").style.display="none",document.getElementById("jag-abo-actif").style.display="none",document.getElementById("jag-abo-stop").style.display="none",document.getElementById("jag-abo-resilli-text").innerHTML=0>dog.collar.formula_subscription.timeout-Date.now()?getTrad("Votre abonnement est termin\xE9 depuis le<br>","Your subscription ended on<br>")+getDate(dog.collar.formula_subscription.timeout):getTrad("Votre abonnement est r\xE9sili\xE9.<br>Il prendra fin le ","Your subscription is cancelled<br>.It will end on ")+getDate(dog.collar.formula_subscription.timeout),document.getElementById("jag-"+e+"-name").innerHTML=n?getTrad(n.metadata.title_fr,n.metadata.title_en):getTrad("Formule \xE0 vie","Life formula"),document.getElementById("jag-abo-stoped-action").style.display=0>dog.collar.formula_subscription.timeout-Date.now()?"none":"flex",document.getElementById("jag-abo-stoped-action").addEventListener("click",()=>document.getElementById("jl-active-action-popup").style.display="flex"),t=document.getElementById("jag-abo-check"),setChecked(t.childNodes[0].childNodes[0],"no"),t.childNodes[0].style.backgroundColor="red",t.childNodes[0].childNodes[0].style.height="12px";break;case"active":document.getElementById("jag-abo-stoped").style.display="none",document.getElementById("jag-abo-actif").style.display="flex",document.getElementById("jag-abo-resilli").style.display="none",document.getElementById("jag-abo-stop").style.display="flex",document.getElementById("jag-"+e+"-name").innerHTML=n?getTrad(n.metadata.title_fr,n.metadata.title_en):getTrad("Formule \xE0 vie","Life formula"),document.getElementById("jag-abo-stoped-action").style.display="none",document.getElementById("jag-"+e+"-actif-start").innerHTML=getTrad("Abonnement actif depuis le ","Subscription active since ")+getDate(dog.collar.formula_subscription.subscription_date),document.getElementById("jag-"+e+"-actif-end").innerHTML=getTrad("Jusqu'au ","until ")+getDate(dog.collar.formula_subscription.timeout);break;case"refused":return document.getElementById("jag-abo-resilli").style.display="none",document.getElementById("jag-abo-actif").style.display="none",document.getElementById("jag-abo-stoped").style.display="flex",t=document.getElementById("jag-abo-check"),setChecked(t.childNodes[0].childNodes[0],"warn"),t.childNodes[0].style.backgroundColor="orange",t.childNodes[0].childNodes[0].style.height="12px",document.getElementById("jag-abo-stoped-action").style.display="none",void(document.getElementById("jl-abo-change").style.display="none");default:document.getElementById("jag-abo-none").style.display="flex",document.getElementById("jl-abo-historic").style.display="none",document.getElementById("jl-abo-change").style.display="none",document.getElementById("jag-abo-none-action").addEventListener("click",()=>window.open(REDIRECT.abo,"_self")),a.style.display="none"}switch(dog.collar.formula_subscription.type){case"yearly":document.getElementById("jl-abo-change").innerHTML=getTrad("Passer \xE0 la formule \xE0 vie","Switching to a lifetime formula"),document.getElementById("jl-abo-change").addEventListener("click",()=>window.open(REDIRECT.formula_life,"_self"));break;case"monthly":document.getElementById("jl-abo-change").innerHTML=getTrad("Changer ma formule","Change my formula"),document.getElementById("jl-abo-change").addEventListener("click",()=>window.open(REDIRECT.abo,"_self"));break;case"life":document.getElementById("jag-abo-stop").style.display="none",document.getElementById("jl-abo-change").style.display="none",document.getElementById("jag-"+e+"-actif-end").style.display="none";break;default:document.getElementById("jag-abo-none").style.display="flex",document.getElementById("jl-abo-historic").style.display="none",document.getElementById("jl-abo-change").style.display="none",document.getElementById("jag-abo-none-action").addEventListener("click",()=>window.open(REDIRECT.abo,"_self")),a.style.display="none"}}),document.getElementById("jag-abo-container").style.display="block"},getDate=e=>{var t=new Date(e),a=t.getDate(),n=t.getMonth()+1,i=t.getFullYear()%100;10>a&&(a="0"+a),10>n&&(n="0"+n),10>i&&(i="0"+i);var l=a+"/"+n+"/"+i;return l},getSize=e=>"verySmall"===e?getTrad("Tr\xE8s petite","Very small"):"small"===e?getTrad("Petite","Small"):"tall"===e?getTrad("Grande","Tall"):"veryTall"===e?getTrad("Tr\xE8s grande","Very Tall"):getTrad("Moyenne","Average"),getSilhouette=e=>"verySkinny"===e?getTrad("Tr\xE8s maigre","Very Skinny"):"skinny"===e?getTrad("Maigre","skinny"):"Maigre"===e?getTrad("Exc\xE8s de poids","Excess weight"):"obese"===e?getTrad("En surpoids","Overweight"):getTrad("Id\xE9ale","Ideal"),getAboType=e=>"monthly"===e?getTrad("Paiement mensuel","Monthly payment"):"yearly"===e?getTrad("Paiement annuel","Yearly payment"):getTrad("\xC0 vie","For life"),getActivity=e=>"footing"===e?getTrad("CaniCross","CaniCross"):"chasse"===e?getTrad("Chasse","Hunting"):"bike"===e?getTrad("CaniVTT","CaniVTT"):"crossfit"===e?getTrad("Parcours libre","Crossfit"):"promenade"===e?getTrad("Balade","Walk"):"city_dogsitting"===e?getTrad("DogSitting","DogSitting"):"cani_rando"===e?getTrad("CaniRando","CaniRando"):"away"===e?getTrad("Absence","Away"):"rescue"===e?getTrad("Localisation","Location"):`Autre (${e})`,getMonth=e=>0===e?getTrad("janv","jan"):1===e?getTrad("f\xE9vr","feb"):2===e?getTrad("mars","mar"):3===e?getTrad("avri","apr"):4===e?getTrad("mai","may"):5===e?getTrad("juin","june"):6===e?getTrad("juil","july"):7===e?getTrad("ao\xFBt","aug"):8===e?getTrad("sept","sept"):9===e?getTrad("octo","octo"):10===e?getTrad("nove","nove"):11===e?getTrad("d\xE9ce","dece"):"",redirectStep2=()=>{window.localStorage.serial&&window.localStorage.phone||window.open(REDIRECT.active,"_self")},aboAction=async e=>{const t=window.location.origin+window.location.pathname;let a=document.getElementById("jag_Abonnement_check"),n=findNewAbonnementSolo(e).prices[0];if("false"===n.metadata.activation||a&&a.checked){loaderContainer.style.display="flex";const e=await fetch("https://app-api.mypet.fit/stripe/checkout_session/subscription",{method:"POST",headers:header,body:JSON.stringify({subscription:n.id,phone:window.localStorage.phone,serialNumber:window.localStorage.serial,referer:t})}).then(async e=>await e?.json());return void(e.url?(loaderContainer.style.display="none",window.open(e.url,"_self")):(showAddCart("Oups, une erreur est survenue, rechargez la page",!0),setTimeout(()=>{window.open(REDIRECT.active,"_self")},"1000")))}return a&&a.checked?void 0:void showAddCart(getTrad("Vous devez accepter les frais d'activitation","You must accept the activation fee"))},updateContainerBorder=e=>{["jl_Abonnement_Starter","jl_Abonnement_Family","jl_Abonnement_Premium"].forEach(t=>document.getElementById(t).className=t==e?"abo_border_on":"abo_border_off")},toMonth=()=>{document.getElementById("jl_abo-facture-mois").className="abo_btn_on",document.getElementById("jl_abo-facture-annee").className="abo_btn_off",document.getElementById("jl_abo-facture-life").className="abo_btn_off",aboType=["starter","starter-family","premium-family"],aboType.forEach(e=>{document.getElementById("jl-abo-"+e+"-top").innerHTML=getTrad("Sans engagement","No obligation"),document.getElementById("jl-abo-"+e+"-bottom").innerHTML="",document.getElementById("jl-abo-"+e+"-price").innerHTML=displayPrice(findAboType(findAbonnement(e),"monthly").price)+getTrad("\u20AC/mois","\u20AC/month")})},toYear=()=>{document.getElementById("jl_abo-facture-mois").className="abo_btn_off",document.getElementById("jl_abo-facture-annee").className="abo_btn_on",document.getElementById("jl_abo-facture-life").className="abo_btn_off",aboType=["starter","starter-family","premium-family"],aboType.forEach(e=>{document.getElementById("jl-abo-"+e+"-top").innerHTML=getTrad("2 mois offerts","2 months free"),document.getElementById("jl-abo-"+e+"-bottom").innerHTML=getTrad("Paiement de ","")+displayPrice(findAboType(findAbonnement(e),"yearly").price)+getTrad("\u20AC tous les ans","\u20AC billed annualy"),document.getElementById("jl-abo-"+e+"-price").innerHTML=(findAboType(findAbonnement(e),"yearly").price/12).toFixed(2)+getTrad("\u20AC/mois","\u20AC/month")})},toLife=()=>{document.getElementById("jl_abo-facture-mois").className="abo_btn_off",document.getElementById("jl_abo-facture-annee").className="abo_btn_off",document.getElementById("jl_abo-facture-life").className="abo_btn_on",aboType=["starter","starter-family","premium-family"],aboType.forEach(e=>{document.getElementById("jl-abo-"+e+"-top").innerHTML=getTrad("Formule sans abonnement","no-subscription formula"),document.getElementById("jl-abo-"+e+"-bottom").innerHTML=getTrad("1 paiement unique","1 single payment"),document.getElementById("jl-abo-"+e+"-price").innerHTML=findAboType(findAbonnement(e),"life").price+"\u20AC"})},initMap=async(e,t)=>{const{Map:a}=await google.maps.importLibrary("maps");if(0>dog.collar.formula_subscription.timeout-Date.now())return document.getElementById("jl-rescue-action").innerHTML=getTrad("Lancer une g\xE9olocalisation","Launch a geolocation"),document.getElementById("jl-rescue-action").parentElement.style.backgroundColor="grey",void(document.getElementById("jl-rescue-msg").innerHTML=getTrad("Votre abonnement est arriv\xE9 \xE0 expiration !<br>Vous n'avez plus acc\xE8s \xE0 cette fonctionnalit\xE9.","Your subscription has expired!<br>You no longer have access to this feature."));let n,i=await fetch(baseurl+`/collar/${dog.collar.simcardID}/checkgeolocation`,{method:"GET",headers:header}).then(async e=>e.json());i.CellTower?(n={lat:i.CellTower.lat,lng:i.CellTower.lon},!map&&(map=new a(e,{zoom:14,center:n,mapId:"map"})),circle=new google.maps.Circle({strokeColor:"grey",fillColor:"grey",strokeOpacity:.8,strokeWeight:2,fillOpacity:.35,map,center:n,radius:i.CellTower?.accuracy??500}),map.setCenter(n),map.setZoom(14),!t&&initRescue(document.getElementById("jl-rescue-action"))):setTimeout(()=>initMap(e),2e4)},initActivity=e=>{if("moment"!=e){let t=["var(--main)","var(--gristypofaible)"];document.getElementById("jag-detail-activity").style.display="none"==e,"rescue"==e&&(t=t.reverse()),document.getElementById("jl-activity-activity").style.color=t[0],document.getElementById("jl-activity-activity").style.borderColor=t[0],document.getElementById("jl-activity-rescue").style.color=t[1],document.getElementById("jl-activity-rescue").style.borderColor=t[1]}let t=document.getElementById("jl-activity-card-container");for(let a=t.childNodes.length-1;1<=a;a--)t.childNodes[a].remove();let a=document.getElementById("jag-activity-card"),n="moment"==e?dog.activities.moments:"activity"==e?dog.activities.personalActivities:dog.activities.rescues;n.sort(function(e,t){return new Date(t.start_timestamp)-new Date(e.start_timestamp)}),n.forEach(n=>{let i;n.start_timestamp&&n.end_timestamp&&(newCard=a.cloneNode(!0),changeChildsId(newCard,"-"+n._id,"jl"),newCard["data-id"]=n._id,t.appendChild(newCard),newCard.style.display="flex",document.getElementById("jl-activity-card-type-"+n._id).innerHTML=getActivity(n.activity_id),start=new Date(n.start_timestamp),end=new Date(n.end_timestamp),n.start_timestamp&&n.end_timestamp&&(document.getElementById("jl-activity-card-time-"+n._id).innerHTML="De "+(10>start.getHours()?"0"+start.getHours():start.getHours())+"h"+(10>start.getMinutes()?"0"+start.getMinutes():start.getMinutes())+" \xE0 "+(10>end.getHours()?"0"+end.getHours():end.getHours())+"h"+(10>end.getMinutes()?"0"+end.getMinutes():end.getMinutes()),document.getElementById("jl-activity-card-duration-"+n._id).innerHTML=n.duration?new Date(1e3*n.duration).toISOString().substring(14,19):new Date(0).toISOString().substring(14,19),document.getElementById("jl-activity-card-date-"+n._id).innerHTML=start.getDate()+" "+getMonth(start.getMonth())),n.distance&&(i=1e3<n.distance?n.distance/1e3+"Km":n.distance+"m"),document.getElementById("jl-activity-card-img-"+n._id)&&(document.getElementById("jl-activity-card-img-"+n._id).children[0].src=ACTIVITY_PICT[n.activity_id],document.getElementById("jl-activity-card-img-"+n._id).children[0].srcset=ACTIVITY_PICT[n.activity_id]),"moment"!=e&&(document.getElementById("jl-activity-card-distance-"+n._id).innerHTML=getTrad("Distance parcourue de ","Distance covered of ")+(i??"0m")),"activity"==e&&(n.duration&&n.distance?newCard.addEventListener("click",()=>setMap(n)):(newCard.style.color="#00000036",newCard.style.opacity=.5)),"rescue"==e&&newCard.addEventListener("click",()=>setRescue(n)))}),a.style.display="none"},setBound=()=>{if(!map||!path)return;let t,a,n=new google.maps.LatLngBounds,l=path.getPath(),o=l.getAt(0).lat(),r=l.getAt(0).lng();for(let n,e=1;e<l.getLength();e++)n=l.getAt(e),t=t<n.lat()?t:n.lat(),o=o>n.lat()?o:n.lat(),a=a<n.lng()?a:n.lng(),r=r>n.lng()?r:n.lng();n.extend(new google.maps.LatLng(t,a)),n.extend(new google.maps.LatLng(o,r)),map.fitBounds(n)},setRescue=async e=>{clearMap(),icon||(icon={url:"https://assets-global.website-files.com/6549f4ba8294cf140608d893/664e065a96ae535c2291cf88_dog%20pict.png",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)}),document.getElementById("jag-detail-activity").style.display="none",document.getElementById("jag-detail-rescue").style.display="none";let t=await fetch("https://app-api.mypet.fit/personal_activity/"+e._id,{headers:header}).then(async e=>await e.json()).then(e=>e.data);if(!t.gps_data_affine)return void showAddCart(getTrad("Oups, pas de donn\xE9es disponibles pour cette localisation","Oops, no data available for this location"));let a=Object.values(JSON.parse(t.gps_data_affine)).map(e=>(res={},res.lat=e.lat,res.lng=e.lng,res));if(!map)try{const{Map:e}=await google.maps.importLibrary("maps");map=new e(document.getElementById("jl-map"),{zoom:14,center:a[0],mapId:"DEMO_MAP_ID"})}catch(t){showAddCart("Oups, une erreur est survenue, rechargez la page",!0)}let n;a.forEach((e,t)=>{n={lat:e.lat,lng:e.lng};let a=new google.maps.Marker({map:map,position:n,title:"",opacity:0==t?1:.2,icon:icon??`https://assets-global.website-files.com/6549f4ba8294cf140608d893/664c893a5d2b02d82784dbdc_imagedog.png`});markers.push(a)}),map.setCenter(n)},setMap=async e=>{document.getElementById("jag-detail-activity").style.display="flex",document.getElementById("jag-detail-rescue").style.display="none";let t=await fetch("https://app-api.mypet.fit/personal_activity/"+e._id,{headers:header}).then(async e=>await e.json());if(!t.data.gps_data)return void showAddCart(getTrad("Oups pas de donn\xE9es"),"Oops, no data");clearMap();let a=Object.values(JSON.parse(t.data.gps_data)).map(e=>(res={},res.lat=e.lat,res.lng=e.lng,res));if(!map)try{const{Map:e}=await google.maps.importLibrary("maps");map=new e(document.getElementById("jl-map"),{zoom:14,center:a[0],mapId:"DEMO_MAP_ID"})}catch(t){showAddCart("Oups, une erreur est survenue, rechargez la page",!0)}path=new google.maps.Polyline({path:a,geodesic:!0,strokeColor:"#4287f5",width:5}),path.setMap(map),setBound(),document.getElementById("jag-detail-activity-lenght").innerHTML=(1e3<t.data.distance?t.data.distance/1e3:t.data.distance).toFixed(2),document.getElementById("jag-detail-activity-lenght-id").innerHTML=1e3<t.data.distance?"Km":"m",document.getElementById("jag-detail-activity-time").innerHTML=new Date(1e3*t.data.duration).toISOString().substring(14,19),document.getElementById("jag-detail-activity-speed").innerHTML=`${t.data.distance/1e3/(t.data.duration??1)}`.substring(0,3)},resendActivationCode=async()=>{let e=window.localStorage.getItem("serial"),t=window.localStorage.getItem("phone");if(!e||!t)return void showAddCart("Oups, une erreur est survenue, rechargez la page",!0);const a=await fetch("https://app-api.mypet.fit/event/resend_activation_token",{method:"POST",headers:header,body:JSON.stringify({phone:res=t.slice(0,-9).replace("+","0000000").slice(-4)+t.slice(-9),serialNumber:e})}).then(e=>e.status);200==a?showAddCart(getTrad("Le code a \xE9t\xE9 renvoy\xE9","The code has been resended")):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},resendCode=async()=>{let e=document.getElementById("jag-email").value;if(!e)return void showAddCart("Oups, une erreur est survenue, rechargez la page",!0);const t=await fetch("https://app-api.mypet.fit/resend_token",{method:"POST",headers:header,body:JSON.stringify({email:e,type:"sms"})}).then(e=>e.status);200==t?showAddCart(getTrad("Le code a \xE9t\xE9 renvoy\xE9","The code has been resended")):showAddCart("Oups, une erreur est survenue, rechargez la page",!0)},validateAction=async()=>{let e=document.getElementById("Jag_Activation_phoneToken").value,t=window.localStorage.getItem("serial"),a=window.localStorage.getItem("phone");if(!e)return void showAddCart("Oups, une erreur est survenue, rechargez la page",!0);const n=await fetch("https://app-api.mypet.fit/login/activation",{method:"POST",headers:header,body:JSON.stringify({phone:res=a.slice(0,-9).replace("+","0000000").slice(-4)+a.slice(-9),serialNumber:t,phoneToken:e})}).then(async e=>await e?.json());n.result?n.result.activated?window.open(REDIRECT.active_3+"?session_id=725","_self"):window.open(REDIRECT.active_2,"_self"):showAddCart(getTrad("Code incorrect","Incorrect code"))},checkActivationToken=async()=>{let e=new URLSearchParams(window.location.search).get("HeyJag"),t=new URLSearchParams(window.location.search).get("sn");if(e&&t){header.Authorization="Bearer "+e;const a=await fetch("https://app-api.mypet.fit/login/activation/token",{method:"POST",headers:header,body:JSON.stringify({serialNumber:t})}).then(async e=>await e?.json());a.result&&(window.localStorage.serial=t,window.localStorage.phone=a.result.phone,a.result.activated?window.open(REDIRECT.active_3+"?session_id=725","_self"):window.open(REDIRECT.active_2,"_self"))}},checkActivation=async()=>{let e=document.getElementById("jl_Activation_serialNumber").value,t=document.getElementById("jl_Activation_phoneNumber").value.replaceAll(" ","");if(!t.match(/\+[0-9]{2,3}[0-9]{9}/))return void showAddCart(getTrad("Num\xE9ro de t\xE9l\xE9phone incorrect (+33612345678)","Incorrect telephone number (+33612345678)"));if(!e.match("JL[A-Za-z0-9]-[A-Za-z0-9]{8}"))return void showAddCart(getTrad("Num\xE9ro de serie incorrect (JL1-1111A11A,)","Incorrect serial number (JL1-1111A11A,)"));t=t.slice(0,-9).replace("+","0000000").slice(-4)+t.slice(-9);const a=await fetch("https://app-api.mypet.fit/collar/serialNumber",{method:"POST",headers:header,body:JSON.stringify({serialNumber:e,phone:t})}).then(async e=>e.status);200===a?document.getElementById("Jag_Popup_phoneToken")?(document.getElementById("Jag_Popup_phoneToken").style.display="flex",window.localStorage.serial=e,window.localStorage.phone=t):showAddCart("Oups, une erreur est survenue, rechargez la page",!0):400===a?(showAddCart(getTrad("Ce bo\xEEtier est d\xE9j\xE0 activ\xE9","This collar has already been activated")),setTimeout(()=>{window.open(REDIRECT.login,"_self")},"1000")):404===a?showAddCart(getTrad("Bo\xEEtier inconnu","Unknown collar")):403===a?showAddCart(getTrad("Le num\xE9ro de t\xE9l\xE9phone ne correspond pas \xE0 l'acheteur du collier","The telephone number does not correspond to the purchaser of the necklace")):void 0},getCart=async()=>{let e=new URLSearchParams(window.location.search);if(!e.has("session_id"))return void window.open(REDIRECT.active,"_self");let t=e.get("session_id");if(result=await fetch("https://app-api.mypet.fit/order/checkout/"+t,{method:"GET",headers:header}),200!=result.status&&"725"!=t)return void window.open(REDIRECT.active,"_self");const a=await result.json();"725"==t?document.getElementById("jag-active-store").style.display="none":a.result?.hasAccount?(localStorage.removeItem("dog"),document.getElementById("jag-active-store").style.display="none"):document.getElementById("jag-active-dasboard").style.display="none"},getOption=async()=>window.localStorage.getItem("option")?void(option=JSON.parse(window.localStorage.getItem("option"))):void(result=await fetch("https://app-api.mypet.fit/collar_options/e-commerce/options",{method:"GET",headers:header}),200!=result.status&&showAddCart("Oups, une erreur est survenue, rechargez la page",!0),option=await result.json(),window.localStorage.setItem("option",JSON.stringify(option))),getAbonnement=async()=>{if(window.localStorage.abonnement){let e=JSON.parse(window.localStorage.abonnement);if(0!=e.length)return void(abonnement=e)}let e=await fetch(`${interfaceUrl}/stripe/products/category/subscription`,{method:"GET",headers:header});window.localStorage.setItem("abonnement",JSON.stringify(e)),abonnement=e},getDog=async e=>{dog=JSON.parse(localStorage.getItem("dog"));dog&&!e||(0==user.dogs.length&&(showAddCart(getTrad("Vous n'avez pas de chien li\xE9 \xE0 un collier","No dog found")),localStorage.removeItem("token"),setTimeout(()=>{window.open(REDIRECT.login,"_self")},"1000")),0!=user.dogs.length&&(dog=await fetch("https://app-api.mypet.fit/dog/"+(e??user.dogs[0]._id),{headers:header}).then(async e=>await e.json()).then(e=>e.dog),dog.battery=await fetch("https://app-api.mypet.fit/collar/"+dog.collar.simcardID+"/battery",{headers:header}).then(async e=>await e.json()).then(e=>e.BatteryInfos),dog.flash=await fetch(`https://app-api.mypet.fit/collar/${dog.collar.simcardID}/flash`,{method:"GET",headers:header}).then(async e=>await e.json()),dog.geolocation=fetch(baseurl+`/collar/${dog.collar.simcardID}/checkgeolocation`,{method:"GET",headers:header}).then(async e=>e.json()).then(e=>(document.getElementById("jl-collar-synchro-state")&&(document.getElementById("jl-collar-synchro-state").innerHTML=e.endpointStatus?getTrad("Le bo\xEEtier est connect\xE9","The collar is connected"):getTrad("Le bo\xEEtier est en veille","The collar is not connected")),e)),dog.dock=await fetch(baseurl+`/collar/${dog.collar.simcardID}/dock`,{method:"GET",headers:header}).then(async e=>e.json()),dog.dock.result.assigned&&dog.dock.result.dock?.serial_number&&(dog.dock.data=await fetch("https://app-api.mypet.fit/dock/getStatus",{headers:header,method:"POST",body:JSON.stringify({serial_number:dog.dock.result.dock?.serial_number,dog_id:dog._id})}).then(async e=>await e.json())),!dog.welfareData&&(await getWelfareData())),window.localStorage.setItem("dog",JSON.stringify(dog)))};let getNewAbo=()=>dog.collar.formula_subscription.type?findNewAbonnementSolo(dog.collar.formula_subscription.type).prices[0]:dog.collar.formula_subscription.type;const getUser=async()=>{user=JSON.parse(localStorage.getItem("user")),user||(user=await fetch("https://app-api.mypet.fit/profile/full",{headers:header}).then(async e=>await e.json()).then(e=>e.user),user.galery=await fetch("https://app-api.mypet.fit/user/gallery?sharing=false",{headers:header}).then(async e=>await e.json()).then(async e=>e.personalActivities),window.localStorage.setItem("user",JSON.stringify(user))),await getDog()},setidentity=()=>{initFamily();let e=dog.race??dog.dadRace??dog.momRace,t=JSON.parse(dog.food??"{}");if(document.getElementById("jag-profil-identity-pict").src="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid,document.getElementById("jag-profil-identity-pict").srcset="https://app-api.mypet.fit/img/"+dog.image.type+"/"+dog.image.uuid,document.getElementById("jag-profil-identity-name").innerHTML=dog.name,document.getElementById("jag-profil-identity-Iname").innerHTML=dog.name,document.getElementById("jag-profil-identity-id").innerHTML="@"==dog.publicId[0]?dog.publicId:`@${dog.publicId}`,document.getElementById("jag-profil-identity-bio").innerHTML=dog.biography??getTrad("Biographie","Biography"),document.getElementById("jag-profil-identity-sexe").innerHTML="male"==dog.gender?getTrad("M\xE2le","Male"):getTrad("Femelle","Female"),document.getElementById("jag-profil-identity-birthdate").innerHTML=getDate(dog.birthDate),document.getElementById("jag-profil-identity-weight").innerHTML=dog.weight+"Kg",document.getElementById("jag-profil-identity-size").innerHTML=getSize(dog.size),document.getElementById("jag-profil-identity-silouhette").innerHTML=getSilhouette(dog.silhouette),document.getElementById("jag-profil-identity-breed").innerHTML=e.name,document.getElementById("jag-profil-identity-lof").firstChild.style["background-color"]=dog.isLOF?"":"grey",dog.isLOF||setChecked(document.getElementById("jag-profil-identity-lof").firstChild.firstChild,"no"),document.getElementById("jag-profil-identity-lof").firstChild.firstChild.style.height="12px",document.getElementById("jag-profil-identity-steril").firstChild.style["background-color"]=dog.sterilized?"":"grey",dog.sterilized||setChecked(document.getElementById("jag-profil-identity-steril").firstChild.firstChild,"no"),document.getElementById("jag-profil-identity-steril").firstChild.firstChild.style.height="12px",document.getElementById("jag-profil-food-moring").innerHTML=(t.morning??"-")+" g",document.getElementById("jag-profil-food-noon").innerHTML=(t.noon??"-")+" g",document.getElementById("jag-profil-food-night").innerHTML=(t.evening??"-")+" g",document.getElementById("jag-profil-food-all").innerHTML=0==(t.morning??0)+(t.noon??0)+(t.evening??0)?"-":(t.morning??0)+(t.noon??0)+(t.evening??0)+"g",t.foodType&&t.foodType.type&&(document.getElementById("jag-profil-food-type").innerHTML="indus"==t.foodType.type?"Croquette":getTrad("Fait maison","Home made")),document.getElementById("jag-profil-welfare-calory")){document.getElementById("jag-profil-welfare-calory").innerHTML=dog.welfareData?.global?.calory_global??"-";let e=new Date(null);e.setSeconds(dog.welfareData?.global?.rest_global),document.getElementById("jag-profil-welfare-rest").innerHTML=e.toISOString().slice(11,16).replace(":","h"),document.getElementById("jag-profil-welfare-trophy").innerHTML=dog.welfareData?.global?.trophy_global??"-",document.getElementById("jag-profil-welfare-welfare").innerHTML=dog.welfareData?.global?.welfare_global??"-"}},initDashboard=async e=>{await getUser(),initGalery(),loaderContainer.style.display="flex";let t=document.getElementById("jag-profil-dog-container");0==user.dogs.length&&(localStorage.removeItem("token"),showAddCart(getTrad("Vous n'avez pas de chien li\xE9 \xE0 un collier","No dog found")),setTimeout(()=>{window.open(REDIRECT.login,"_self")},"1000")),user.dogs.forEach(a=>{document.getElementById("jag-profil-dog-container-"+a._id)||(newCard=t.cloneNode(!0),newCard.style.display="flex",changeChildsId(newCard,"-"+a._id,"jag-"),e.appendChild(newCard),document.getElementById("jag-profil-dog-name-"+a._id).innerHTML=a.name??"",document.getElementById("jag-profil-dog-id-"+a._id).innerHTML=a.publicId??"",document.getElementById("jag-profil-dog-pict-"+a._id).src="https://app-api.mypet.fit/img/"+a.image.type+"/"+a.image.uuid,document.getElementById("jag-profil-dog-pict-"+a._id).srcset="https://app-api.mypet.fit/img/"+a.image.type+"/"+a.image.uuid,newCard.addEventListener("click",async()=>{loaderContainer.style.display="flex",await getDog(a._id),setAll(),loaderContainer.style.display="none",setidentity()}))}),setidentity(),loaderContainer.style.display="none"},checkAuth=async()=>{let e=new URL(window.location.href),t=new URLSearchParams(window.location.search);if(!document.querySelectorAll("[jl-auth='false']").length&&e.href.includes("my"))if(document.querySelectorAll("[jl-auth='login']").length){let a=t.has("redirect")?t.get("redirect"):"home";a=REDIRECT[a];let n=localStorage.getItem("token")??e.searchParams.get("HeyJag");if(n)return localStorage.setItem("token",n),header.Authorization="Bearer "+n,void window.open(a,"_self")}else{if(localStorage.getItem("token"))return token=window.localStorage.getItem("token"),void(header.Authorization="Bearer "+token);if(e.searchParams.has("HeyJag"))return token=e.searchParams.get("HeyJag"),header.Authorization="Bearer "+token,void localStorage.setItem("token",token);else{let t=Object.keys(REDIRECT).find(t=>REDIRECT[t]===e.pathname.split("/").pop())??REDIRECT.home;window.open(REDIRECT.login+"?redirect="+t,"_self")}}},getWelfareData=async()=>{let e=Date.now(),t=await fetch(baseurl+`/collar/${dog.collar.simcardID}/new_welfare_data/${e}`,{method:"GET",headers:header}).then(async e=>e.json());dog.welfareData=t},disableButton=()=>{let e=JSON.parse(localStorage.getItem("dog")).collar.formula_subscription.type;if(0!=collarId)for(elem of document.querySelectorAll("[id=jl-product-abo-container]"))if(elem.onclick=()=>showAddCart("Vous ne pouvez pas s\xE9l\xE9ctionner cette formule...",!1),elem.classList.add("selected"),elem.getAttribute("jl_productid")=="6644bc10947f9d11efacd4ad")return},getAll=async()=>{loaderContainer||(loaderContainer=document.createElement("div"),loaderContainer.style="width: 100Vw;height: 100VH;position: absolute;justify-content: center;align-items: center;background-color: #8080806e;",loaderContainer.innerHTML="<lottie-player src=\"https://webcart.jagger-lewis.com/loader%20site.json\" background=\"transparent\" speed=\"1\"style=\"width: 300px; height: 300px;\"  autoplay></lottie-player>",body.insertBefore(loaderContainer,document.body.firstChild)),loaderContainer.style.display="flex",document.getElementById("jag-step-3")?await getCart():document.getElementById("jag-step-2")?(redirectStep2(),await loadAbonnement(),abonnement=JSON.parse(localStorage.getItem("abonnement")),initAboB()):document.getElementById("jag-formula")?(await loadAbonnement(),abonnement=JSON.parse(localStorage.getItem("abonnement")),await getOption(),await getUser(),await initOption()):document.getElementById("jag-switch-abo")?(await loadAbonnement(),abonnement=JSON.parse(localStorage.getItem("abonnement")),await getUser(),initAboB(),disableButton()):document.getElementById("jag-abo-stop")?(await loadAbonnement(),abonnement=JSON.parse(localStorage.getItem("abonnement")),await getUser()):(document.getElementById("jag-profil-dog-name")||document.getElementById("jl-collar-battery")||document.getElementById("jl-galery-list-0"))&&(await getUser()),document.getElementById("jl-collar-battery")&&(await getDog(dog._id)),loaderContainer.style.display="none",setAll()},setAll=()=>{var e=document.querySelectorAll("[id^=\"jl\"]");e.forEach(e=>{initClient[e.id]?initClient[e.id](e):console.log(e.id+" is not handle :(")})};document.getElementById("JL_NavBar")||(checkAuth(),getAll());