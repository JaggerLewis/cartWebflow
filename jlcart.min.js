const interfaceUrl="https://heyjag.mypet.fit",body=document.querySelector("body"),JL_NavBar=document.getElementById("JL_NavBar");console.log("\uD83D\uDC3E Jag is on the way"),document.querySelector("#jl-aqua-modal")&&document.addEventListener("scroll",()=>document.querySelector("#jl-aqua-modal").style.display="none");const getTrad=(a,b)=>window.location.href.split("/").find(a=>"en"==a)?b:a;function displayPrice(a){return 0==a%1?a+".00":0==(a%.1).toFixed(5)?a+"0":""+a}const setCartNbItems=()=>{if(JL_NavBar){let a=0;localStorage.getItem("JagSession")&&JSON.parse(localStorage.getItem("JagSession")).cart.forEach(b=>a+=b.quantity),document.getElementById("jl-cart-number").textContent=a}};class Product{constructor(a,b,c,d,e){this.name=a,this.description=b,this.metadata=c,this.image=d,this.price=e}}class ProductCart{constructor(a,b){this.id=a,this.quantity=b}}class ShoppingCart{constructor(){localStorage.getItem("shoppingCart")&&localStorage.removeItem("shoppingCart");let a={cart:[],orderId:void 0,orderNumber:void 0,orderTotalAmount:0,orderShippingCost:0,orderItems:[],session_id:void 0,session_creation_time:Date.now(),customerEmail:void 0,tsEncartEmail:Date.now(),tsEncartIsHide:!1};localStorage.getItem("JagSession")?a=JSON.parse(localStorage.getItem("JagSession")):(console.log("\uD83D\uDC3E New Jag Session"),localStorage.setItem("JagSession",JSON.stringify(a)),a=JSON.parse(localStorage.getItem("JagSession"))),a.customerEmail||(console.log("\uD83D\uDC3E JAG SET CUSTO"),a.customerEmail=void 0,!a.tsEncartIsHide&&(a.tsEncartEmail=Date.now(),a.tsEncartIsHide=!1),localStorage.setItem("JagSession",JSON.stringify(a))),this.cart=[];for(const b of a.cart)this.cart.push(new ProductCart(b.id,b.quantity));this.orderId=a.orderId,this.orderNumber=a.orderNumber,this.orderTotalAmount=a.orderTotalAmount,this.orderShippingCost=a.orderShippingCost,this.orderItems=a.orderItems,this.session_id=a.session_id,this.session_creation_time=a.session_creation_time,this.customerEmail=a.customerEmail,this.tsEncartEmail=Date.now(),this.tsEncartIsHide=!1,this.orderId!=null&&console.log("\uD83D\uDC3E "+this.orderId.toString())}findProductIndexById(a){return this.cart.findIndex(b=>b.id.price.id===a.price.id)}viewItem(a){console.log("event","view_item",a),gtag("event","view_item",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]})}addItem(a,b=1){getTrad(a.name+" ajout\xE9 au panier",a.name+" add to cart");const c=new ProductCart(a,b);console.log("event","add_to_cart",a),gtag("event","add_to_cart",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]}),gtag("event","conversion",{send_to:"AW-726660854/6--KCJCjh7cZEPbtv9oC"}),console.log("event","conversion pushed"),this.cart.push(c),this.saveCart({event:{type:"addItem",id:a,count:b}}),hideSubscription()}removeItem(a,b=1){const c=this.findProductIndexById(a);if(-1>c)throw new Error;this.cart[c].quantity-=b,0>=this.cart[c].quantity&&this.clearItem(a),console.log("event","remove_from_cart",a),gtag("event","remove_from_cart",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]}),this.saveCart({event:{type:"removeItem",id:a,count:b}})}clearItem(a){const b=this.findProductIndexById(a);if(-1>b)throw new Error;this.cart.splice(b,1),this.saveCart({event:{type:"clearItem",id:a}}),console.log("--"+a.toString())}RemoveSession(){console.log("RemoveSession")}RemoveCartItems(){console.log("RemoveCartItems")}getTotalPrice(){let a=0;return this.cart.forEach(b=>{a+=b.id.price.price*b.quantity}),a}getReductionAmount(){let a=0,b=JSON.parse(localStorage.getItem("JagSession"));if(b.customerEmail&&""!=b.customerEmail&&"undefined"!=b.customerEmail&&(a=20),document.getElementById("JL_Basket_Discount_Amount")){const b=document.getElementById("JL_Basket_Discount_Amount");0<a&&(document.getElementById("JL_Basket_Discount_Div").style.display="flex",b.innerHTML="- "+a.toFixed(2)+" &euro;")}else a=0;return a}getDeliveryPrice(){const a=document.getElementById("JL_Basket_Delivery_Amount");return a.innerHTML="Offerts",console.log(0),0 .toFixed(2)}setTotalPrice(){let a=this.getTotalPrice();const b=document.getElementById("JL_Basket_Cart_Amount");b.innerHTML=a.toFixed(2)+" &euro;";let c=this.getDeliveryPrice(),d=this.getReductionAmount(),e=a+c-d;const f=document.getElementById("JL_Basket_Total_Amount");return f.innerHTML=e.toFixed(2)+" &euro;",e.toFixed(2)}saveOrderId(a){let b=JSON.parse(localStorage.getItem("JagSession"));b.orderId=a,localStorage.setItem("JagSession",JSON.stringify(b)),console.log("\uD83D\uDC3E JAG orderId Saved ",this.orderId)}saveCustomerEmail(a){let b=JSON.parse(localStorage.getItem("JagSession"));b.customerEmail=a,localStorage.setItem("JagSession",JSON.stringify(b)),console.log("\uD83D\uDC3E JAG CUSTO IS ON FIRE")}hideCustomerEmail(){let a=JSON.parse(localStorage.getItem("JagSession"));a.tsEncartEmail=Date.now(),a.tsEncartIsHide=!0,localStorage.setItem("JagSession",JSON.stringify(a)),console.log("\uD83D\uDC3E JAG BYE COCODE")}undoCustomerEmail(){let a=JSON.parse(localStorage.getItem("JagSession"));a.tsEncartEmail=Date.now()-9e7,a.tsEncartIsHide=!1,a.customerEmail=void 0,localStorage.setItem("JagSession",JSON.stringify(a)),console.log("\uD83D\uDC3E JAG BYE COCODE")}askCustomerEmail(){let a=JSON.parse(localStorage.getItem("JagSession"));return a.customerEmail&&""!=a.customerEmail&&"undefined"!=a.customerEmail?(console.log("\uD83D\uDC3E JAG CUSTO IS FINE"),!1):a.tsEncartIsHide?a.tsEncartEmail<Date.now()-864e5?(console.log("\uD83D\uDC3E JAG CUSTO [RE]-ASK"),!0):(console.log("\uD83D\uDC3E JAG CUSTO WAIT"),!1):(console.log("\uD83D\uDC3E JAG CUSTO ASK"),!0)}saveCart({callApi:b=!0,event:a}={}){let c=JSON.parse(localStorage.getItem("JagSession"));c.cart=this.cart,localStorage.setItem("JagSession",JSON.stringify(c)),setCartNbItems(),b&&this.updateCartInDb({event:a}).then(a=>{a.json().then(a=>{a.success&&(this.orderId=a.orderId,this.saveOrderId(a.orderId))})})}getCartStripeUrl(){const a=window.location.origin+window.location.pathname;let b=this.cart.map(a=>({id:a.id.price.id,quantity:a.quantity})),c={cart:b,orderId:this.orderId,mode:"payment",referer:a};const d=fetch(`${interfaceUrl}/stripe/checkout_session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});return d}updateCartInDb({event:a}={}){const b=JSON.parse(localStorage.getItem("JagSession"));try{const c=fetch(`${interfaceUrl}/stripe/cart`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:b.cart,orderId:b.orderId,event:a,customerEmail:b.customerEmail})});return c}catch(a){return console.error("Error Saving CartDB",a),{success:!1}}}}const shoppingCart=new ShoppingCart;let products=[];const findProduct=(a,b)=>{const c=products.find(c=>c.metadata.pId===a&&(!b||c.metadata.colorId===b));return c},findAbonnement=a=>{let b=abonnement.find(b=>b.metadata.pId==a);return b},findAboType=(a,b)=>{let c=a.prices.find(a=>a.metadata.pricing==b);return c},SlideToColor=a=>{slides=document.getElementById("jl-slide-mask-product"),withSlide=slides.offsetWidth,"fauve"==a&&(nbSlide=0);"weimar"==a&&(nbSlide=1);"charbon"==a&&(nbSlide=2);for(const b of slides.children)b.style.transform="translateX(-"+(nbSlide*withSlide).toString()+"px)",b.style.transition="transform 500ms cubic-bezier(0.55, 0.085, 0.68, 0.53) 0s";navSlide=document.getElementById("jl-slide-nav-product");for(const b of navSlide.children)0<b.getAttribute("aria-label").indexOf(nbSlide+1)?(b.className="w-slider-dot w-active",b.setAttribute("aria-pressed",!0),b.setAttribute("tabindex",0)):(b.className="w-slider-dot",b.setAttribute("aria-pressed",!1),b.setAttribute("tabindex",-1))},setBtnColor=a=>{document.querySelectorAll("[id^=txt-color-]").forEach(a=>a.classList.remove("txt-color-selected")),document.getElementById("txt-color-"+a).classList.add("txt-color-selected")},initJagGPS=async()=>(colors.forEach(a=>{document.getElementById("btn_boitier_color_"+a).addEventListener("click",b=>{b.preventDefault(),setBtnColor(a),SlideToColor(a),document.activeElement.blur()})}),setBtnColor(initialColor),!0),initNewsLettre=()=>{document.querySelector("#btn-restons-en-contact").addEventListener("click",()=>{let a=document.querySelector("#input-restons-en-contact").value;fetch(`${interfaceUrl}/newsletter/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})})})},initAboB=async()=>{},refreshOrderInfo=async()=>{if(document.getElementById("JL_CHECKOUT_LOADER").style.display="block",document.getElementById("JL_CHECKOUT_INFOS").style.display="none",!document.getElementById("JL_ORDER"))return console.log("\uD83D\uDC3E JAG WRONG CONTENT"),!1;document.getElementById("JL_ORDER").style.display="none";let a=new URLSearchParams(window.location.search).get("session_id"),b=await fetch(`${interfaceUrl}/stripe/checkout_session/`+a+"/cart").then(a=>a.json());if(console.log("\uD83D\uDC3E JAG CS DATAS",b),document.getElementById("JL_ORDER")&&(document.getElementById("JL_ORDER_ID").textContent=b.orderNumber,document.getElementById("JL_ORDER").style.display="flex"),document.getElementById("JL_USER_EMAIL"))try{document.getElementById("JL_USER_EMAIL").textContent=b.aside_data.customerDetails.email}catch(a){console.log("\uD83D\uDC3E JAG CS DATAS NO EMAIL")}document.getElementById("JL_CHECKOUT_INFOS").style.display="flex",document.getElementById("JL_CHECKOUT_LOADER").style.display="none";let c=[],d=0,e=0,f=b.orderNumber,g=b.aside_data.cart;for(i=0;i<g.length;i++){let a=g[i],b="";a.description&&(-1<a.description.toLowerCase().indexOf("weimar")&&(b="Weimar"),-1<a.description.toLowerCase().indexOf("fauve")&&(b="Fauve"),-1<a.description.toLowerCase().indexOf("charbon")&&(b="Charbon")),newItem={item_id:a.price.product,item_name:a.description,index:0,item_brand:"Jagger & Lewis",item_variant:b,price:a.amount_total,quantity:a.quantity},d+=a.amount_total,c.push(newItem)}d+=e,orderTotalTax=parseInt(d/1.2),purchaseInfos={transaction_id:f,value:d/100,tax:orderTotalTax/100,shipping:e/100,currency:"EUR",items:c},gtag("event","purchase",purchaseInfos),console.log("\uD83D\uDC3E JAG gtag Purchase Sent",purchaseInfos),conversionValue={send_to:"AW-726660854/rlPfCLWfg7cZEPbtv9oC",value:d/100,currency:"EUR",transaction_id:f},gtag("event","conversion",conversionValue),console.log("\uD83D\uDC3E JAG gtag Conversion Sent",conversionValue)},changeChildsId=(a,b,c)=>{if(c?a.id&&a.id.includes(c)&&(a.id+=b):a.id+=b,a.hasChildNodes)for(var d=a.childNodes,e=0;e<d.length;e++)changeChildsId(d[e],b,c)},init=async()=>{console.log("\uD83D\uDC3E JAG IS HERE "+JL_pageId),JL_NavBar&&(document.getElementById("JL_Basket_Item").style.display="none",document.getElementById("JL_Basket_Empty").style.display="block",document.getElementById("jl-cart-number").addEventListener("click",a=>showNewCart(a)),document.getElementById("jag-cart").addEventListener("click",a=>showNewCart(a)),document.getElementById("JL_Btn_Close_Basket").addEventListener("click",()=>{hideSubscription(),document.getElementById("JL_Basket").style.display="none",document.getElementById("JL_Basket_Discount_Div").style.display="none"})),document.getElementById("JL_Abo_Newsletter")&&initNewsLettre(),document.getElementById("jl-collar")&&initJagGPS(),document.getElementById("jl-checkout-redirect"),"confirm_checkout"==JL_pageId&&refreshOrderInfo(),setCartNbItems(),page=window.location.href.split("/")[3].split("?")[0]},hideSubscription=()=>{if("undefined"==typeof abo_list)return;let a=shoppingCart.cart.filter(a=>!0==a.id.metadata.subscription)[0]?.id?.metadata?.productId,b=[...abo_list].filter(a=>"subscription"==a.getAttribute("jl_category"));b.forEach(a=>{a.style.backgroundColor=null,a.style.color=null,a.style.pointerEvents="auto"}),a&&b.forEach(b=>{b.getAttribute("jl_productId")!=a&&(b.style.backgroundColor="#f5f5f5",b.style.color="#00000052",b.style.pointerEvents="none")})},redirectToStripe=async a=>{console.log("Start Checkout");try{a.preventDefault()}catch(a){}shoppingCart.cart.forEach(a=>{"price_1Q5pKjADzHYMiB1YAxkcjLSv"==a.id.price.id&&(a.id.price.id="price_1P9Nh8ADzHYMiB1Y0XMZ9v4y"),"price_1QIBgoADzHYMiB1Y6CQ1JsIu"==a.id.price.id&&(a.id.price.id="price_1P9NihADzHYMiB1YCTWgreKk")});const b=await shoppingCart.getCartStripeUrl(),c=await b.json();if(c.url)try{console.log("event","begin_checkout",c.url),gtag("event","begin_checkout",{event_callback:function(){window.location.href=c.url}})}catch(a){console.log("error with tag manager : ",a)}else showAddCart("",!0)},showNewCart=a=>{function b(){document.getElementById("JL_Basket_Empty").style.display="flex",document.getElementById("JL_Basket_Items").style.display="none",document.getElementById("JL_Basket_Delivery_Amount").style.display="none",document.getElementById("JL_Basket_Boutons").style.display="none",document.getElementById("JL_Basket").style.display="flex",document.getElementById("JL_Basket_Total").style.display="none"}function c(a){let b=document.getElementById("JL_Basket_Item"),c=b.cloneNode(!0);c.setAttribute("id","JL_Basket_Item_"+a);for(const b of c.childNodes)b.hasChildNodes()?b.childNodes.forEach(b=>{b.hasChildNodes()?b.childNodes.forEach(b=>{b.id.startsWith("JL_Basket_Item")&&(b.setAttribute("id",b.id+"_"+a),console.log(b))}):b.id.startsWith("JL_Basket_Item")&&(b.setAttribute("id",b.id+"_"+a),console.log(b))}):b.id.startsWith("JL_Basket_Item")&&(b.setAttribute("id",b.id+"_"+a),console.log(b));document.getElementById("JL_Basket_Items").appendChild(c)}try{a.preventDefault()}catch(a){}if(document.getElementById("JL_Basket_Valide_Commande").addEventListener("click",a=>{a.preventDefault(),redirectToStripe(),document.activeElement.blur()}),0==shoppingCart.cart.length)return b(),!0;nbItem=1,function(){const a=document.getElementById("JL_Basket_Items");for(const b of a.children)"JL_Basket_Item"!=b.id&&b.remove()}();let d=[];shoppingCart.cart.forEach(a=>{c(nbItem),document.getElementById("JL_Basket_Item_Label_"+nbItem).innerHTML=getTrad(a.id.metadata.title_fr,a.id.metadata.title_en),document.getElementById("JL_Basket_Item_Color_"+nbItem).innerHTML=a.id.metadata.colorId;let e=getTrad("qt\xE9 : ","qty : ");document.getElementById("JL_Basket_Item_Ref_"+nbItem).innerHTML=a.id.metadata.pId+" ("+e+a.quantity+")",document.getElementById("JL_Basket_Item_Img_"+nbItem).src=a.id.image,document.getElementById("JL_Basket_Item_Img_"+nbItem).removeAttribute("srcset"),document.getElementById("JL_Basket_Item_Price_"+nbItem).innerHTML=(a.quantity*a.id.price.price).toFixed(2)+" &euro;",document.getElementById("JL_Basket_Item_Trash_Icon_"+nbItem).setAttribute("nbItem",nbItem),document.getElementById("JL_Basket_Item_Trash_Icon_"+nbItem).addEventListener("click",c=>{c.preventDefault(),ligneId=document.getElementById(c.target.id).getAttribute("nbItem"),itemLineChild=document.getElementById("JL_Basket_Item_"+ligneId),document.getElementById("JL_Basket_Items").removeChild(itemLineChild),shoppingCart.clearItem(a.id),shoppingCart.setTotalPrice(),console.log("event","remove_from_cart"),gtag("event","remove_from_cart",{currency:"EUR",value:a.id.price.price/100,items:[{item_id:a.id.metadata.productId,item_name:a.id.metadata.title_fr,item_brand:"Jagger Lewis",item_variant:a.id.metadata.colorId,price:a.id.price.price/100,quantity:a.quantity}]}),0==shoppingCart.cart.length&&b(),document.activeElement.blur()}),document.getElementById("JL_Basket_Item_"+nbItem).style.display="flex",d.push({item_id:a.id.metadata.productId,item_name:a.id.metadata.title_fr,item_brand:"Jagger & Lewis",item_variant:a.id.metadata.colorId,price:a.id.price.price,quantity:a.quantity}),nbItem++});let e=shoppingCart.setTotalPrice();view_cart_event={currency:"EUR",value:e,items:d},console.log("event","view_cart",view_cart_event),gtag("event","view_cart",view_cart_event),document.getElementById("JL_Basket_Total").style.display="flex",document.getElementById("JL_Basket_Boutons").style.display="flex",document.getElementById("JL_Basket_Item").style.display="none",document.getElementById("JL_Basket_Empty").style.display="none",document.getElementById("JL_Basket").style.display="flex",document.getElementById("JL_Basket_Content").style.display="block",document.getElementById("JL_Basket_Items").style.display="flex"},showAddCart=(a,b)=>{b&&(a=getTrad("Oups, une erreur est survenue, rechargez la page","Oops, an error has occurred, reload the page")),document.getElementById("JL_AddCart_Snack_Label").textContent=a,document.getElementById("JL_AddCart_Snack").style.display="block",setTimeout(function(){document.getElementById("JL_AddCart_Snack").style.display="none"},3e3)};document.getElementById("validate-cart")&&(document.getElementById("validate-cart").onclick=a=>{redirectToStripe(a)});var colors=["fauve","weimar","charbon"],devices=["jag","jag-smartdock"],initialColor="fauve",initialDevice="jag-smartdock";const appendPage=a=>{let b=document.createElement("script");b.type="text/javascript",b.src=a,document.getElementsByTagName("head")[0].appendChild(b)};if("undefined"==typeof JL_pageId&&(JL_pageId=""),document.getElementById("JL_NavBar")||"confirm_checkout"==JL_pageId){init(),document.getElementById("jl-product-selector-global")&&(console.log("launch webflow embed script viewItem"),viewItem_EmbedWebflow(),hideSubscription());let a=new URLSearchParams(document.location.search);var stripe_cancel=a.get("stripe_cancel");null!=stripe_cancel&&console.log("event","stripe_cancel")}else appendPage("https://cdnjs.cloudflare.com/ajax/libs/lottie-player/2.0.4/lottie-player.js"),appendPage("https://webcart.jagger-lewis.com/jlclient.js");