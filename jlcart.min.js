const interfaceUrl="https://heyjag.mypet.fit",body=document.querySelector("body"),JL_NavBar=document.getElementById("JL_NavBar");document.querySelector("#jl-aqua-modal")&&document.addEventListener("scroll",()=>document.querySelector("#jl-aqua-modal").style.display="none");const getTrad=(a,b)=>window.location.href.split("/").find(a=>"en"==a)?b:a;function displayPrice(a){return 0==a%1?a+".00":0==(a%.1).toFixed(5)?a+"0":""+a}const setCartNumber=()=>{if(JL_NavBar){let a=0;localStorage.getItem("shoppingCart")&&JSON.parse(localStorage.getItem("shoppingCart")).forEach(b=>a+=b.quantity),document.getElementById("jl-cart-number").textContent=a}};class Product{constructor(a,b,c,d,e){this.name=a,this.description=b,this.metadata=c,this.image=d,this.price=e}}class ProductCart{constructor(a,b){this.id=a,this.quantity=b}}class ShoppingCart{constructor(){if(localStorage.getItem("shoppingCart")){let a=JSON.parse(localStorage.getItem("shoppingCart"));this.cart=[];for(const b of a)this.cart.push(new ProductCart(b.id,b.quantity));this.orderId=localStorage.getItem("orderId")??void 0}else this.cart=[],this.orderId=void 0}findProductIndexById(a){return this.cart.findIndex(b=>b.id.price.id===a.price.id)}viewItem(a){console.log("event","view_item",a),gtag("event","view_item",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]})}addItem(a,b=1){getTrad(a.name+" ajout\xE9 au panier",a.name+" add to cart");const c=new ProductCart(a,b);console.log("event","add_to_cart",a),gtag("event","add_to_cart",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]}),this.cart.push(c),this.saveCart({event:{type:"addItem",id:a,count:b}}),hideSubscription()}removeItem(a,b=1){const c=this.findProductIndexById(a);if(-1>c)throw new Error;this.cart[c].quantity-=b,0>=this.cart[c].quantity&&this.clearItem(a),console.log("event","remove_from_cart",a),gtag("event","remove_from_cart",{currency:"EUR",value:a.price.price/100,items:[{item_id:a.sku,item_name:a.name,price:a.price.price/100,quantity:1}]}),this.saveCart({event:{type:"removeItem",id:a,count:b}})}clearItem(a){const b=this.findProductIndexById(a);if(-1>b)throw new Error;this.cart.splice(b,1),this.saveCart({event:{type:"clearItem",id:a}})}getTotalPrice(){let a=0;return this.cart.forEach(b=>{a+=b.id.price.price*b.quantity}),a}setTotalPrice(){let a=this.getTotalPrice();const b=document.getElementById("JL_Basket_Total_Amount");return b.innerHTML=a.toFixed(2)+" &euro;",a.toFixed(2)}saveCart({callApi:b=!1,event:a}={}){localStorage.setItem("shoppingCart",JSON.stringify(this.cart)),setCartNumber(),b&&this.updateCartInDb({event:a}).then(a=>{a.json().then(a=>{a.success&&(this.orderId=a.orderId,localStorage.setItem("orderId",this.orderId))}).catch(a=>{console.error("error parsing",a)})}).catch(a=>{console.error("error fetching",a)})}getCartStripeUrl(){const a=window.location.origin+window.location.pathname;let b=this.cart.map(a=>({id:a.id.price.id,quantity:a.quantity}));const c=fetch(`${interfaceUrl}/stripe/checkout_session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:b,orderId:this.orderId,mode:"payment",referer:a})});return c}updateCartInDb({event:a}={}){try{const b=fetch(`${interfaceUrl}/stripe/cart`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:this.cart,orderId:this.orderId,event:a})});return b}catch(a){return console.log(a),!0}}}const shoppingCart=new ShoppingCart;let products=[];const findProduct=(a,b)=>{const c=products.find(c=>c.metadata.pId===a&&(!b||c.metadata.colorId===b));return c},findAbonnement=a=>{let b=abonnement.find(b=>b.metadata.pId==a);return b},findAboType=(a,b)=>{let c=a.prices.find(a=>a.metadata.pricing==b);return c},SlideToColor=a=>{slides=document.getElementById("jl-slide-mask-product"),withSlide=slides.offsetWidth,"fauve"==a&&(nbSlide=0);"weimar"==a&&(nbSlide=1);"charbon"==a&&(nbSlide=2);for(const b of slides.children)b.style.transform="translateX(-"+(nbSlide*withSlide).toString()+"px)",b.style.transition="transform 500ms cubic-bezier(0.55, 0.085, 0.68, 0.53) 0s";navSlide=document.getElementById("jl-slide-nav-product");for(const b of navSlide.children)0<b.getAttribute("aria-label").indexOf(nbSlide+1)?(b.className="w-slider-dot w-active",b.setAttribute("aria-pressed",!0),b.setAttribute("tabindex",0)):(b.className="w-slider-dot",b.setAttribute("aria-pressed",!1),b.setAttribute("tabindex",-1))},setBtnColor=a=>{document.querySelectorAll("[id^=txt-color-]").forEach(a=>a.classList.remove("txt-color-selected")),document.getElementById("txt-color-"+a).classList.add("txt-color-selected")},initJagGPS=async()=>(colors.forEach(a=>{document.getElementById("btn_boitier_color_"+a).addEventListener("click",b=>{b.preventDefault(),setBtnColor(a),SlideToColor(a),document.activeElement.blur()})}),setBtnColor(initialColor),!0),initNewsLettre=()=>{document.querySelector("#btn-restons-en-contact").addEventListener("click",()=>{let a=document.querySelector("#input-restons-en-contact").value;fetch(`${interfaceUrl}/newsletter/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})})})},initAboB=async()=>{},refreshOrderInfo=async()=>{document.getElementById("JL_ORDER")&&(document.getElementById("JL_ORDER").style.display="none");let a=new URLSearchParams(window.location.search).get("session_id");a||window.open("/404","_self");let b=await loadCart(a);localStorage.setItem("session_id",a),document.getElementById("JL_ORDER")&&(document.getElementById("JL_ORDER_ID").textContent=b.orderNumber,document.getElementById("JL_ORDER").style.display="flex");let c=0,d=[],e=b.aside_data.cart;for(i=0;i<e.length;i++){let a=b.aside_data.cart[i];shoppingCart.clearItem(a);let e="";a.description?(-1<a.description.toLowerCase().indexOf("weimar")&&(e="Weimar"),-1<a.description.toLowerCase().indexOf("fauve")&&(e="Fauve"),-1<a.description.toLowerCase().indexOf("charbon")&&(e="Charbon")):e=null,newItem={item_id:a.price.product,item_name:a.description,index:0,item_brand:"Jagger & Lewis",item_variant:e,price:a.amount_total,quantity:a.quantity},c+=a.amount_total,d.push(newItem)}shipping_cost=599,c+=shipping_cost,order_total_tax=parseInt(c/1.2),gtag("event","purchase",{transaction_id:b.orderNumber,value:c/100,tax:order_total_tax/100,shipping:shipping_cost/100,currency:"EUR",items:d}),console.log("gtag purchase ok",b.orderNumber,shipping_cost,c,order_total_tax)},changeChildsId=(a,b,c)=>{if(c?a.id&&a.id.includes(c)&&(a.id+=b):a.id+=b,a.hasChildNodes)for(var d=a.childNodes,e=0;e<d.length;e++)changeChildsId(d[e],b,c)},loadCart=async a=>await fetch(`${interfaceUrl}/stripe/checkout_session/`+a+"/cart").then(a=>a.json()),init=async()=>{JL_NavBar&&(document.getElementById("JL_Basket_Item").style.display="none",document.getElementById("JL_Basket_Empty").style.display="block",document.getElementById("jl-cart-number").addEventListener("click",a=>showNewCart(a)),document.getElementById("jag-cart").addEventListener("click",a=>showNewCart(a)),document.getElementById("JL_Btn_Close_Basket").addEventListener("click",()=>{hideSubscription(),document.getElementById("JL_Basket").style.display="none"})),document.getElementById("JL_Abo_Newsletter")&&initNewsLettre(),document.getElementById("jl-collar")&&initJagGPS(),document.getElementById("jl-checkout-redirect")&&refreshOrderInfo(),setCartNumber(),page=window.location.href.split("/")[3].split("?")[0]},hideSubscription=()=>{if("undefined"==typeof abo_list)return;let a=shoppingCart.cart.filter(a=>!0==a.id.metadata.subscription)[0]?.id?.metadata?.productId,b=[...abo_list].filter(a=>"subscription"==a.getAttribute("jl_category"));b.forEach(a=>{a.style.backgroundColor=null,a.style.color=null,a.style.pointerEvents="auto"}),a&&b.forEach(b=>{b.getAttribute("jl_productId")!=a&&(b.style.backgroundColor="#f5f5f5",b.style.color="#00000052",b.style.pointerEvents="none")})},redirectToStripe=async a=>{console.log("Start Checkout");try{a.preventDefault()}catch(a){}shoppingCart.cart.forEach(a=>{"price_1Q5pKjADzHYMiB1YAxkcjLSv"==a.id.price.id&&(a.id.price.id="price_1P9Nh8ADzHYMiB1Y0XMZ9v4y"),"price_1QIBgoADzHYMiB1Y6CQ1JsIu"==a.id.price.id&&(a.id.price.id="price_1P9NihADzHYMiB1YCTWgreKk")});const b=await shoppingCart.getCartStripeUrl(),c=await b.json();if(console.log("apiResJson",c),c.url)try{gtag("event","begin_checkout",{event_callback:function(){window.location.href=c.url}})}catch(a){console.log("error with tag manager : ",a)}else showAddCart("",!0)},showNewCart=a=>{function b(){document.getElementById("JL_Basket_Empty").style.display="flex",document.getElementById("JL_Basket_Items").style.display="none",document.getElementById("JL_Basket_Delivery_Amount").style.display="none",document.getElementById("JL_Basket_Boutons").style.display="none",document.getElementById("JL_Basket").style.display="flex",document.getElementById("JL_Basket_Total").style.display="none"}function c(a){let b=document.getElementById("JL_Basket_Item"),c=b.cloneNode(!0);c.setAttribute("id","JL_Basket_Item_"+a);for(const b of c.childNodes)b.hasChildNodes()?b.childNodes.forEach(b=>{b.id.startsWith("JL_Basket_Item")&&b.setAttribute("id",b.id+"_"+a)}):b.id.startsWith("JL_Basket_Item")&&b.setAttribute("id",b.id+"_"+a);document.getElementById("JL_Basket_Items").appendChild(c)}try{a.preventDefault()}catch(a){}if(document.getElementById("JL_Basket_Valide_Commande").addEventListener("click",a=>{a.preventDefault(),redirectToStripe(),document.activeElement.blur()}),0==shoppingCart.cart.length)return b(),!0;nbItem=1,function(){const a=document.getElementById("JL_Basket_Items");for(const b of a.children)"JL_Basket_Item"!=b.id&&b.remove()}();let d=[];shoppingCart.cart.forEach(a=>{c(nbItem),document.getElementById("JL_Basket_Item_Label_"+nbItem).innerHTML=getTrad(a.id.metadata.title_fr,a.id.metadata.title_en);let e=getTrad("qt\xE9 : ","qty : ");document.getElementById("JL_Basket_Item_Ref_"+nbItem).innerHTML=a.id.metadata.pId+" ("+e+a.quantity+")",document.getElementById("JL_Basket_Item_Img_"+nbItem).src=a.id.image,document.getElementById("JL_Basket_Item_Img_"+nbItem).removeAttribute("srcset"),document.getElementById("JL_Basket_Item_Price_"+nbItem).innerHTML=(a.quantity*a.id.price.price).toFixed(2)+" &euro;",document.getElementById("JL_Basket_Item_Trash_Icon_"+nbItem).setAttribute("nbItem",nbItem),document.getElementById("JL_Basket_Item_Trash_Icon_"+nbItem).addEventListener("click",c=>{c.preventDefault(),ligneId=document.getElementById(c.target.id).getAttribute("nbItem"),itemLineChild=document.getElementById("JL_Basket_Item_"+ligneId),document.getElementById("JL_Basket_Items").removeChild(itemLineChild),shoppingCart.clearItem(a.id),shoppingCart.setTotalPrice(),console.log("event","remove_from_cart"),gtag("event","remove_from_cart",{currency:"EUR",value:a.id.price.price/100,items:[{item_id:a.id.metadata.productId,item_name:a.id.metadata.title_fr,item_brand:"Jagger Lewis",item_variant:a.id.metadata.colorId,price:a.id.price.price/100,quantity:a.quantity}]}),0==shoppingCart.cart.length&&b(),document.activeElement.blur()}),document.getElementById("JL_Basket_Item_"+nbItem).style.display="flex",d.push({item_id:a.id.metadata.productId,item_name:a.id.metadata.title_fr,item_brand:"Jagger & Lewis",item_variant:a.id.metadata.colorId,price:a.id.price.price,quantity:a.quantity}),nbItem++});let e=shoppingCart.setTotalPrice();gtag("event","view_cart",{currency:"EUR",value:e/100,items:d}),document.getElementById("JL_Basket_Total").style.display="flex",document.getElementById("JL_Basket_Boutons").style.display="flex",document.getElementById("JL_Basket_Item").style.display="none",document.getElementById("JL_Basket_Empty").style.display="none",document.getElementById("JL_Basket").style.display="flex",document.getElementById("JL_Basket_Content").style.display="block",document.getElementById("JL_Basket_Items").style.display="flex"},showAddCart=(a,b)=>{b&&(a=getTrad("Oups, une erreur est survenue, rechargez la page","Oops, an error has occurred, reload the page")),document.getElementById("JL_AddCart_Snack_Label").textContent=a,document.getElementById("JL_AddCart_Snack").style.display="block",setTimeout(function(){document.getElementById("JL_AddCart_Snack").style.display="none"},3e3)};document.getElementById("validate-cart")&&(document.getElementById("validate-cart").onclick=a=>{redirectToStripe(a)});var colors=["fauve","weimar","charbon"],devices=["jag","jag-smartdock"],initialColor="fauve",initialDevice="jag-smartdock";const appendPage=a=>{let b=document.createElement("script");b.type="text/javascript",b.src=a,document.getElementsByTagName("head")[0].appendChild(b)};if(document.getElementById("JL_NavBar")){init(),document.getElementById("jl-product-selector-global")&&(console.log("launch webflow embed script viewItem"),viewItem_EmbedWebflow(),hideSubscription());let a=new URLSearchParams(document.location.search);var stripe_cancel=a.get("stripe_cancel");null!=stripe_cancel&&console.log("event","stripe_cancel")}else appendPage("https://cdnjs.cloudflare.com/ajax/libs/lottie-player/2.0.4/lottie-player.js"),appendPage("https://webcart.jagger-lewis.com/jlclient.js");console.log("\uD83D\uDC3E Jag is on the way");